# Longevity App - Comprehensive Project Plan

## Project Overview

**Mission:** Build an exceptional, evidence-based longevity app with an n8n workflow backend and a top-notch React frontend.

**Key Differentiators:**
- Science-backed protocols from leading longevity researchers
- Comprehensive biological age tracking
- AI-powered personalized recommendations
- Seamless wearable integrations (Oura, WHOOP, Apple Health)
- Beautiful, accessible dashboard UI

---

## Part 1: Evidence-Based Longevity Science

### The 9 Hallmarks of Aging (López-Otín et al.)

| Hallmark | Description | Trackable Markers |
|----------|-------------|-------------------|
| Genomic Instability | DNA damage accumulation | Epigenetic clocks |
| Telomere Attrition | Chromosome end shortening | Telomere length tests |
| Epigenetic Alterations | Gene expression changes | DNA methylation (GrimAge, PhenoAge) |
| Loss of Proteostasis | Protein quality control decline | Heat shock proteins |
| Deregulated Nutrient Sensing | mTOR, AMPK pathway dysfunction | Glucose, insulin, IGF-1 |
| Mitochondrial Dysfunction | Energy production decline | VO2 max, lactate threshold |
| Cellular Senescence | "Zombie cells" accumulation | Inflammatory markers (hs-CRP) |
| Stem Cell Exhaustion | Regenerative capacity loss | Functional markers |
| Altered Intercellular Communication | Chronic inflammation | hs-CRP, IL-6, homocysteine |

### Key Biomarkers to Track

#### Blood Biomarkers (Optimal Ranges)

| Biomarker | Standard "Normal" | Longevity Optimal | Why It Matters |
|-----------|------------------|-------------------|----------------|
| HbA1c | < 5.7% | 4.8-5.2% | Glucose control, glycation |
| Fasting Glucose | < 100 mg/dL | 70-85 mg/dL | Metabolic health |
| hs-CRP | < 3 mg/L | < 1 mg/L | Inflammation marker |
| Homocysteine | < 15 μmol/L | < 10 μmol/L | Cardiovascular risk |
| ApoB | < 130 mg/dL | < 90 mg/dL | Atherosclerosis risk |
| Vitamin D | > 30 ng/mL | 50-80 ng/mL | Immune, bone, mood |
| Triglycerides | < 150 mg/dL | < 100 mg/dL | Metabolic health |
| LDL-C | < 100 mg/dL | < 70 mg/dL | Cardiovascular |

#### Functional Markers

| Marker | Gold Standard | Why Track |
|--------|---------------|-----------|
| **VO2 Max** | Lab test | #1 predictor of all-cause mortality |
| **Grip Strength** | Dynamometer | Predicts mortality, disability |
| **HRV** | Wearable (RMSSD) | Autonomic health, recovery |
| **Resting Heart Rate** | Wearable | Cardiovascular fitness |
| **Sleep Efficiency** | Wearable | Recovery, cognitive health |

#### Epigenetic Age Clocks

| Clock | Generation | Best For |
|-------|------------|----------|
| Horvath | 1st | Pan-tissue biological age |
| PhenoAge | 2nd | Health-related outcomes |
| **GrimAge** | 2nd | **Best mortality predictor** |
| DunedinPACE | 3rd | Rate of aging (pace) |
| TruAge | Commercial | Comprehensive testing |

### Evidence-Based Interventions

#### Exercise (Peter Attia Framework)

**The Four Pillars:**
1. **Stability** - Foundation for all movement
2. **Strength** - Muscle mass preservation (2-3x/week)
3. **Zone 2 Cardio** - Mitochondrial health (3-4 hours/week)
4. **VO2 Max Training** - 4x4 protocol (1x/week)

**Optimal Protocol:**
- **Zone 2:** 60-70% max HR, 45-60 min sessions, 3-4x/week
- **VO2 Max (4x4):** 4 min @ 90% max HR, 4 min recovery, 4-6 rounds
- **Strength:** 2-3x/week, 2-3 sets per muscle group, progressive overload
- **Weekly Total:** ~10 hours mixed training

#### Nutrition & Fasting

**Time-Restricted Eating (16:8):**
- 16-hour fast, 8-hour eating window
- Triggers autophagy (cellular cleanup)
- Improves insulin sensitivity
- Aligns with circadian rhythms

**Protein Optimization:**
- **Leucine Threshold:** 2.5-3g per meal (triggers mTOR/muscle synthesis)
- **Daily Protein:** 1.6-2.2g/kg for active adults
- **Older Adults:** Need ~40% more protein per meal for same effect
- **Distribute:** 25-40g protein across 3-4 meals

**Key Dietary Patterns:**
- Mediterranean diet (strongest evidence)
- Plant-rich with adequate protein
- Minimize ultra-processed foods
- Omega-3 rich (fatty fish 2-3x/week)

#### Sleep Optimization

**Sleep Architecture Targets:**
- **Total:** 7-9 hours
- **Deep Sleep (N3):** 20-25%
- **REM Sleep:** 20-25%
- **Sleep Efficiency:** > 85%

**Optimization Protocol:**
- Consistent bed/wake times (±30 min)
- Morning light exposure (10-30 min)
- Temperature: 16-19°C (60-67°F)
- No food 3 hours before bed
- Supplements: Magnesium 300mg + Glycine 3g

#### Heat & Cold Therapy (Hormesis)

**Sauna Protocol (Huberman):**
- **General Health:** 1 hour/week total, split into 2-3 sessions
- **Cardiovascular:** 4-7x/week reduces CVD risk by 50%
- **Temperature:** 80-100°C (176-212°F)
- **Growth Hormone:** 1x/week, 4x30min sessions (16x increase)

**Cold Exposure:**
- 2-5 exposures/week
- 2-5 minutes @ 10-15°C (50-59°F)
- Benefits: Brown fat activation, inflammation reduction

#### Supplement Stack (Evidence Tiers)

**Tier 1: Strong Evidence**
| Supplement | Dose | Evidence |
|------------|------|----------|
| Vitamin D3 | 4,000-6,000 IU | Target 50-80 ng/mL |
| Omega-3 (EPA+DHA) | 2-4g/day | Cardiovascular, brain |
| Magnesium | 300-400mg | Sleep, muscle, >300 enzymes |
| Creatine | 5g/day | Muscle, cognitive |

**Tier 2: Promising**
| Supplement | Dose | Evidence |
|------------|------|----------|
| NMN/NR (NAD+ precursors) | 500-1000mg | NAD+ restoration |
| Vitamin K2 (MK-7) | 100-200mcg | Calcium routing |
| CoQ10/Ubiquinol | 100-200mg | Mitochondria |

**Tier 3: Emerging (Senolytics)**
| Compound | Protocol | Notes |
|----------|----------|-------|
| Fisetin | 20mg/kg, 2 days/month | Senolytic, natural |
| Quercetin | Often combined with Fisetin | Anti-inflammatory |
| D+Q (Rx) | 100mg D + 1250mg Q, 2 days | Clinical trials ongoing |

### Key Researchers & Protocols

| Researcher | Focus | Key Contribution |
|------------|-------|------------------|
| **David Sinclair** | NAD+, Sirtuins | NMN supplementation |
| **Peter Attia** | Medicine 3.0 | Centenarian Decathlon, VO2 max |
| **Valter Longo** | Fasting | Fasting-mimicking diet (ProLon) |
| **Rhonda Patrick** | Nutrigenomics | Micronutrient optimization |
| **Bryan Johnson** | Blueprint | Comprehensive anti-aging protocol |

---

## Part 2: n8n Workflow Architecture

### System Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                         FRONTEND                                │
│    Next.js 14 + React 19 + shadcn/ui + Tailwind CSS            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      n8n WORKFLOW BACKEND                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Auth API     │  │ Data API     │  │ AI Engine    │          │
│  │ /api/auth/*  │  │ /api/data/*  │  │ /api/ai/*    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Sync Workers │  │ Score Calc   │  │ Notifications│          │
│  │ (Scheduled)  │  │ (Scheduled)  │  │ (Triggered)  │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        DATA LAYER                               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                      Supabase                             │  │
│  │  PostgreSQL + Auth + Realtime + Storage + Edge Functions │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    EXTERNAL INTEGRATIONS                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │  Oura    │ │  WHOOP   │ │ Apple    │ │ Lab APIs │          │
│  │  API     │ │  API     │ │ Health   │ │ (Quest)  │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐                       │
│  │ Claude   │ │ OpenAI   │ │ Twilio   │                       │
│  │ API      │ │ API      │ │ (SMS)    │                       │
│  └──────────┘ └──────────┘ └──────────┘                       │
└─────────────────────────────────────────────────────────────────┘
```

### Core n8n Workflows

#### 1. User Authentication & Profile API

**Webhook Endpoints:**
- `POST /api/auth/register` - New user registration
- `POST /api/auth/login` - User login
- `GET /api/auth/profile` - Get user profile
- `PUT /api/auth/profile` - Update profile

**Workflow Components:**
```
[Webhook] → [Validate Input] → [Supabase Auth] → [Create/Update Profile] → [Response]
```

#### 2. Health Data Sync Workflows

**Oura Ring Sync (Scheduled: Every 6 hours)**
```
[Schedule Trigger]
    → [Get Active Users with Oura]
    → [Loop: For Each User]
        → [HTTP Request: Oura API]
            → /usercollection/daily_sleep
            → /usercollection/daily_activity
            → /usercollection/daily_readiness
        → [Transform Data]
        → [Supabase: Insert Health Metrics]
        → [Trigger: Recalculate Scores]
```

**WHOOP Sync (Webhook: OAuth callback + Scheduled)**
```
[Webhook: OAuth Callback] → [Store Refresh Token] → [Initial Sync]

[Schedule Trigger: Daily]
    → [Get Users with WHOOP]
    → [Loop: Refresh & Fetch]
        → [HTTP Request: WHOOP API]
            → /v1/cycle
            → /v1/recovery
            → /v1/sleep
            → /v1/workout
        → [Transform to Standard Schema]
        → [Supabase: Upsert Metrics]
```

#### 3. Biological Age Calculation Workflow

**Trigger: On new biomarker data or daily schedule**
```
[Trigger: New Biomarker OR Schedule]
    → [Supabase: Get User Profile + Latest Metrics]
    → [Code Node: Calculate Component Scores]
        → Sleep Score (0-100)
        → Activity Score (0-100)
        → Nutrition Score (0-100)
        → Biomarker Score (0-100)
        → Protocol Adherence (0-100)
    → [Code Node: Weighted Biological Age Estimate]
        → PhenoAge-inspired algorithm
        → Compare to chronological age
    → [Supabase: Store Score History]
    → [IF: Significant Change?]
        → [Yes: Trigger Notification]
        → [No: Complete]
```

**Scoring Algorithm (Code Node):**
```javascript
// Simplified biological age estimation
const calculateBioAge = (metrics, chronologicalAge) => {
  const weights = {
    sleep: 0.20,
    activity: 0.25,
    nutrition: 0.15,
    biomarkers: 0.25,
    adherence: 0.15
  };

  // Normalize scores (0-100 → deviation from optimal)
  const sleepDeviation = (100 - metrics.sleepScore) * 0.1;
  const activityDeviation = (100 - metrics.activityScore) * 0.12;
  const nutritionDeviation = (100 - metrics.nutritionScore) * 0.08;
  const biomarkerDeviation = calculateBiomarkerAge(metrics.biomarkers);
  const adherenceBonus = metrics.adherenceScore * -0.05;

  const biologicalAge = chronologicalAge
    + (sleepDeviation * weights.sleep)
    + (activityDeviation * weights.activity)
    + (nutritionDeviation * weights.nutrition)
    + (biomarkerDeviation * weights.biomarkers)
    + (adherenceBonus * weights.adherence);

  return {
    biologicalAge: Math.round(biologicalAge * 10) / 10,
    ageDifference: Math.round((biologicalAge - chronologicalAge) * 10) / 10,
    componentScores: { ... }
  };
};
```

#### 4. AI Recommendation Engine

**Trigger: Weekly or on request**
```
[Webhook: /api/ai/recommendations OR Schedule: Weekly]
    → [Supabase: Get User Context]
        → Profile, goals, preferences
        → Last 30 days metrics
        → Current protocol
        → Previous recommendations
    → [Code Node: Prepare AI Prompt]
    → [Claude/OpenAI Node: Generate Recommendations]
        → System: Longevity expert persona
        → Context: User's complete health picture
        → Task: Personalized, actionable recommendations
    → [Code Node: Parse & Structure Response]
    → [Supabase: Store Recommendations]
    → [Response: Return to User]
```

**AI Prompt Template:**
```
You are a longevity and health optimization expert. Based on the following user data, provide 3-5 specific, actionable recommendations to improve their healthspan.

User Profile:
- Age: {{chronologicalAge}}, Biological Age: {{biologicalAge}}
- Primary Goal: {{primaryGoal}}
- Current Protocol: {{currentProtocol}}

Recent Metrics (30-day averages):
- Sleep: {{avgSleepScore}} ({{avgSleepHours}} hours)
- HRV: {{avgHRV}} ms
- Activity: {{avgActivityScore}}
- Fasting Adherence: {{fastingAdherence}}%

Biomarkers (if available):
{{biomarkerSummary}}

Areas Needing Attention:
{{lowScoringAreas}}

Provide recommendations that are:
1. Specific and actionable
2. Based on current scientific evidence
3. Prioritized by impact
4. Tailored to their lifestyle and preferences
```

#### 5. Protocol & Supplement Tracker API

**Endpoints:**
- `GET /api/protocol/today` - Get today's checklist
- `POST /api/protocol/log` - Log completed item
- `GET /api/protocol/streak` - Get streak data
- `GET /api/protocol/adherence` - Get adherence stats

**Workflow:**
```
[Webhook: POST /api/protocol/log]
    → [Validate: Item exists in user's protocol]
    → [Supabase: Insert Log Entry]
    → [Code Node: Update Streak]
    → [IF: Streak Milestone?]
        → [Yes: Award Badge + Notify]
    → [Response: Updated Status]
```

#### 6. Notification System

**Triggers:**
- Morning: Daily summary + action items
- Protocol reminders: Based on user schedule
- Milestone celebrations: Streaks, improvements
- Alerts: Significant metric changes

```
[Schedule: Based on User Preferences]
    → [Supabase: Get Users for This Time Slot]
    → [Loop: For Each User]
        → [Code Node: Build Notification Content]
        → [Switch: Notification Channel]
            → [Push: Send via OneSignal/Expo]
            → [Email: Send via Resend/SendGrid]
            → [SMS: Send via Twilio]
    → [Supabase: Log Notification Sent]
```

### Database Schema (Supabase/PostgreSQL)

```sql
-- Users table (extends Supabase Auth)
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  full_name TEXT,
  date_of_birth DATE,
  gender TEXT,
  height_cm NUMERIC,
  weight_kg NUMERIC,
  timezone TEXT DEFAULT 'UTC',
  primary_goal TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Wearable connections
CREATE TABLE wearable_connections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  provider TEXT NOT NULL, -- 'oura', 'whoop', 'apple_health', 'garmin'
  access_token TEXT,
  refresh_token TEXT,
  token_expires_at TIMESTAMPTZ,
  last_sync_at TIMESTAMPTZ,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Health metrics (time-series)
CREATE TABLE health_metrics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  date DATE NOT NULL,
  source TEXT NOT NULL, -- 'oura', 'whoop', 'manual', etc.

  -- Sleep
  sleep_score INTEGER,
  sleep_duration_minutes INTEGER,
  deep_sleep_minutes INTEGER,
  rem_sleep_minutes INTEGER,
  sleep_efficiency NUMERIC,

  -- Recovery
  hrv_avg NUMERIC,
  hrv_rmssd NUMERIC,
  resting_hr NUMERIC,
  respiratory_rate NUMERIC,
  body_temperature_deviation NUMERIC,
  recovery_score INTEGER,

  -- Activity
  steps INTEGER,
  active_calories INTEGER,
  activity_score INTEGER,
  vo2_max NUMERIC,

  -- Strain
  strain_score NUMERIC,
  workout_minutes INTEGER,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(user_id, date, source)
);

-- Biomarkers
CREATE TABLE biomarkers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  test_date DATE NOT NULL,
  source TEXT, -- 'insidetracker', 'quest', 'manual'

  -- Metabolic
  hba1c NUMERIC,
  fasting_glucose NUMERIC,
  fasting_insulin NUMERIC,

  -- Lipids
  total_cholesterol NUMERIC,
  ldl_c NUMERIC,
  hdl_c NUMERIC,
  triglycerides NUMERIC,
  apob NUMERIC,

  -- Inflammation
  hs_crp NUMERIC,
  homocysteine NUMERIC,

  -- Hormones
  testosterone NUMERIC,
  cortisol NUMERIC,
  igf1 NUMERIC,

  -- Nutrients
  vitamin_d NUMERIC,
  vitamin_b12 NUMERIC,
  ferritin NUMERIC,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Calculated scores
CREATE TABLE health_scores (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  date DATE NOT NULL,

  overall_score INTEGER,
  biological_age NUMERIC,
  age_difference NUMERIC, -- bio age - chrono age

  sleep_score INTEGER,
  activity_score INTEGER,
  nutrition_score INTEGER,
  biomarker_score INTEGER,
  adherence_score INTEGER,

  created_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(user_id, date)
);

-- Protocols & supplements
CREATE TABLE user_protocols (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  name TEXT NOT NULL,
  items JSONB NOT NULL, -- Array of protocol items
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Protocol logs
CREATE TABLE protocol_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  protocol_item_id TEXT NOT NULL,
  logged_at TIMESTAMPTZ DEFAULT NOW(),
  notes TEXT
);

-- Streaks
CREATE TABLE streaks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  streak_type TEXT NOT NULL, -- 'protocol', 'fasting', 'exercise'
  current_count INTEGER DEFAULT 0,
  longest_count INTEGER DEFAULT 0,
  last_logged_date DATE,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- AI Recommendations
CREATE TABLE ai_recommendations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  generated_at TIMESTAMPTZ DEFAULT NOW(),
  recommendations JSONB NOT NULL,
  context_snapshot JSONB, -- User data at time of generation
  is_read BOOLEAN DEFAULT false
);

-- Fasting logs
CREATE TABLE fasting_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  started_at TIMESTAMPTZ NOT NULL,
  ended_at TIMESTAMPTZ,
  target_hours NUMERIC DEFAULT 16,
  actual_hours NUMERIC,
  notes TEXT
);

-- Create indexes for common queries
CREATE INDEX idx_health_metrics_user_date ON health_metrics(user_id, date DESC);
CREATE INDEX idx_health_scores_user_date ON health_scores(user_id, date DESC);
CREATE INDEX idx_protocol_logs_user_date ON protocol_logs(user_id, logged_at DESC);
CREATE INDEX idx_biomarkers_user_date ON biomarkers(user_id, test_date DESC);
```

### n8n Configuration

**Environment Variables:**
```env
N8N_API_URL=https://n8n.srv1235221.hstgr.cloud/api/v1
N8N_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

OURA_CLIENT_ID=your-oura-client-id
OURA_CLIENT_SECRET=your-oura-client-secret

WHOOP_CLIENT_ID=your-whoop-client-id
WHOOP_CLIENT_SECRET=your-whoop-client-secret

ANTHROPIC_API_KEY=your-claude-api-key
OPENAI_API_KEY=your-openai-api-key
```

---

## Part 3: Frontend Architecture

### Technology Stack

| Layer | Technology | Rationale |
|-------|------------|-----------|
| Framework | Next.js 14 (App Router) | SSR, API routes, React 19 support |
| Language | TypeScript | Type safety, better DX |
| Styling | Tailwind CSS v4 | Utility-first, dark mode |
| Components | shadcn/ui | Accessible, customizable |
| State | Zustand + React Query | Simple + server state |
| Charts | Recharts + Tremor | Health data visualization |
| Animations | Framer Motion | Micro-interactions |
| Forms | React Hook Form + Zod | Validation |

### Component Architecture

```
src/
├── app/                          # Next.js App Router
│   ├── (auth)/
│   │   ├── login/
│   │   └── register/
│   ├── (dashboard)/
│   │   ├── layout.tsx
│   │   ├── page.tsx              # Main dashboard
│   │   ├── sleep/
│   │   ├── activity/
│   │   ├── nutrition/
│   │   ├── biomarkers/
│   │   ├── protocols/
│   │   └── settings/
│   └── api/                      # API routes (if needed)
│
├── components/
│   ├── ui/                       # shadcn/ui components
│   ├── dashboard/
│   │   ├── HealthScoreCard.tsx
│   │   ├── BiologicalAgeDisplay.tsx
│   │   ├── MetricCard.tsx
│   │   ├── QuickStats.tsx
│   │   └── ActionItems.tsx
│   ├── charts/
│   │   ├── TrendChart.tsx
│   │   ├── ProgressRing.tsx
│   │   ├── RadarChart.tsx
│   │   └── CalendarHeatmap.tsx
│   ├── tracking/
│   │   ├── ProtocolChecklist.tsx
│   │   ├── SupplementTracker.tsx
│   │   ├── FastingTimer.tsx
│   │   └── StreakCounter.tsx
│   └── layout/
│       ├── Sidebar.tsx
│       ├── Header.tsx
│       └── MobileNav.tsx
│
├── hooks/
│   ├── useHealthMetrics.ts
│   ├── useProtocol.ts
│   ├── useBiologicalAge.ts
│   └── useWearableSync.ts
│
├── lib/
│   ├── api.ts                    # API client
│   ├── supabase.ts               # Supabase client
│   ├── utils.ts                  # Utility functions
│   └── calculations.ts           # Score calculations
│
├── stores/
│   ├── userStore.ts              # User profile state
│   └── settingsStore.ts          # App settings
│
└── types/
    ├── health.ts
    ├── biomarkers.ts
    └── protocols.ts
```

### Design System

**Color Palette:**
```css
:root {
  /* Primary */
  --primary: 221.2 83.2% 53.3%;      /* Blue */
  --primary-foreground: 210 40% 98%;

  /* Status Colors */
  --success: 142.1 76.2% 36.3%;      /* Green - Optimal */
  --warning: 38 92% 50%;              /* Amber - Moderate */
  --destructive: 0 84.2% 60.2%;      /* Red - Attention */

  /* Surfaces */
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --card: 0 0% 100%;
  --muted: 210 40% 96%;

  /* Dark Mode */
  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 8%;
    --muted: 217.2 32.6% 17.5%;
  }
}
```

**Typography:**
```css
:root {
  --font-sans: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;

  /* Scale */
  --text-xs: 0.75rem;     /* 12px */
  --text-sm: 0.875rem;    /* 14px */
  --text-base: 1rem;      /* 16px */
  --text-lg: 1.125rem;    /* 18px */
  --text-xl: 1.25rem;     /* 20px */
  --text-2xl: 1.5rem;     /* 24px */
  --text-4xl: 2.25rem;    /* 36px - Hero metrics */
}
```

### Key UI Components

**1. Health Score Card (Hero)**
```typescript
interface HealthScoreCardProps {
  biologicalAge: number;
  chronologicalAge: number;
  overallScore: number;
  trend: 'improving' | 'stable' | 'declining';
  lastUpdated: Date;
}
```
- Central progress ring showing score
- Biological vs chronological age comparison
- Trend indicator with sparkline
- Tap for detailed breakdown

**2. Metric Cards**
```typescript
interface MetricCardProps {
  title: string;
  value: number;
  unit: string;
  change: number;
  changeLabel: string;
  optimalRange?: [number, number];
  sparklineData?: number[];
  status: 'optimal' | 'moderate' | 'attention';
}
```

**3. Progress Ring**
- SVG-based circular progress
- Animated with Framer Motion
- Color transitions based on progress
- Support for multiple concentric rings

**4. Fasting Timer**
- Circular countdown/countup
- Metabolic state indicators
- Quick start/end buttons
- History view

**5. Protocol Checklist**
- Time-based groupings (morning, afternoon, evening)
- Swipe to complete
- Streak counter
- Notes support

### Navigation Structure

```
┌─────────────────────────────────────────┐
│                 Header                   │
│  [Logo] [Search] [Notifications] [User] │
└─────────────────────────────────────────┘
┌──────────┬──────────────────────────────┐
│          │                              │
│ Sidebar  │      Main Content            │
│          │                              │
│ [Home]   │  ┌────────────────────────┐  │
│ [Sleep]  │  │    Health Score Card   │  │
│ [Activity│  └────────────────────────┘  │
│ [Nutrition│ ┌──────┐ ┌──────┐ ┌──────┐  │
│ [Bio]    │  │Card 1│ │Card 2│ │Card 3│  │
│ [Protocol│  └──────┘ └──────┘ └──────┘  │
│ [Settings│  ┌────────────────────────┐  │
│          │  │    Trend Charts        │  │
│          │  └────────────────────────┘  │
└──────────┴──────────────────────────────┘
```

**Mobile (Bottom Navigation):**
```
┌─────────────────────────────────────────┐
│              Main Content               │
│                                         │
│                                         │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│  [Home] [Track] [+] [Insights] [Profile]│
└─────────────────────────────────────────┘
```

---

## Part 4: Implementation Roadmap

### Phase 1: Foundation (Week 1-2)

**Backend (n8n):**
- [ ] Set up Supabase project with schema
- [ ] Create user auth workflow
- [ ] Build profile CRUD API
- [ ] Set up basic webhook endpoints

**Frontend:**
- [ ] Initialize Next.js 14 project
- [ ] Configure Tailwind CSS + shadcn/ui
- [ ] Set up Supabase client
- [ ] Implement auth flow (login/register)
- [ ] Create base layout components

### Phase 2: Core Features (Week 3-4)

**Backend (n8n):**
- [ ] Oura Ring integration workflow
- [ ] WHOOP integration workflow
- [ ] Health metrics storage API
- [ ] Basic score calculation workflow

**Frontend:**
- [ ] Dashboard layout
- [ ] Health Score Card component
- [ ] Metric Cards with trends
- [ ] Basic charts (line, bar)
- [ ] Wearable connection settings

### Phase 3: Tracking & Protocols (Week 5-6)

**Backend (n8n):**
- [ ] Protocol CRUD API
- [ ] Protocol logging workflow
- [ ] Streak calculation
- [ ] Fasting timer endpoints

**Frontend:**
- [ ] Protocol checklist UI
- [ ] Supplement tracker
- [ ] Fasting timer component
- [ ] Streak counter & badges
- [ ] Calendar heatmap

### Phase 4: AI & Insights (Week 7-8)

**Backend (n8n):**
- [ ] Biological age calculation (advanced)
- [ ] AI recommendation workflow (Claude)
- [ ] Notification system
- [ ] Weekly report generation

**Frontend:**
- [ ] Biological age visualization
- [ ] AI recommendations display
- [ ] Insights & trends page
- [ ] Push notification setup

### Phase 5: Polish & Launch (Week 9-10)

**Backend:**
- [ ] Performance optimization
- [ ] Error handling improvements
- [ ] Rate limiting
- [ ] Backup & monitoring

**Frontend:**
- [ ] Dark mode implementation
- [ ] Micro-interactions & animations
- [ ] Accessibility audit
- [ ] Performance optimization
- [ ] Mobile responsiveness QA

---

## Appendix: API Reference

### n8n Webhook Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/register` | Register new user |
| POST | `/api/auth/login` | User login |
| GET | `/api/profile` | Get user profile |
| PUT | `/api/profile` | Update profile |
| GET | `/api/metrics/today` | Today's health metrics |
| GET | `/api/metrics/history` | Historical metrics |
| GET | `/api/scores/current` | Current health scores |
| GET | `/api/scores/history` | Score history |
| GET | `/api/protocol/today` | Today's protocol |
| POST | `/api/protocol/log` | Log protocol item |
| GET | `/api/fasting/current` | Current fast status |
| POST | `/api/fasting/start` | Start fast |
| POST | `/api/fasting/end` | End fast |
| GET | `/api/recommendations` | Get AI recommendations |
| POST | `/api/wearables/connect` | Connect wearable |
| GET | `/api/wearables/sync` | Trigger manual sync |

---

## Sources & References

### Longevity Science
- [Blueprint Protocol](https://blueprint.bryanjohnson.com/)
- [Peter Attia - Outlive](https://peterattiamd.com/)
- [Huberman Lab - Heat Exposure](https://www.hubermanlab.com/newsletter/deliberate-heat-exposure-protocols-for-health-and-performance)
- [TruDiagnostic - Epigenetic Testing](https://www.trudiagnostic.com/)
- [PubMed - NMN Clinical Trials](https://pubmed.ncbi.nlm.nih.gov/36482258/)

### n8n & Architecture
- [n8n Documentation](https://docs.n8n.io/)
- [n8n Oura Integration](https://n8n.io/integrations/oura/)
- [Supabase + n8n Integration](https://supabase.com/partners/integrations/n8n)
- [n8n AI Agents Guide](https://strapi.io/blog/build-ai-agents-n8n)

### Frontend & UI
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Tremor Charts](https://www.tremor.so/)
- [Recharts Documentation](https://recharts.org/)
- [Framer Motion](https://motion.dev/)
